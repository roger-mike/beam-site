

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>apache_beam.dataframe.frames &mdash; Apache Beam  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Apache Beam
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.coders.html">apache_beam.coders package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.dataframe.html">apache_beam.dataframe package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.internal.html">apache_beam.internal package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.io.html">apache_beam.io package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.metrics.html">apache_beam.metrics package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.ml.html">apache_beam.ml package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.options.html">apache_beam.options package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.portability.html">apache_beam.portability package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.runners.html">apache_beam.runners package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.testing.html">apache_beam.testing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.tools.html">apache_beam.tools package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.transforms.html">apache_beam.transforms package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.typehints.html">apache_beam.typehints package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.utils.html">apache_beam.utils package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.error.html">apache_beam.error module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.pipeline.html">apache_beam.pipeline module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.pvalue.html">apache_beam.pvalue module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apache_beam.version.html">apache_beam.version module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Apache Beam</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>apache_beam.dataframe.frames</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for apache_beam.dataframe.frames</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="c1"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="c1"># this work for additional information regarding copyright ownership.</span>
<span class="c1"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="c1"># (the &quot;License&quot;); you may not use this file except in compliance with</span>
<span class="c1"># the License.  You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">apache_beam.dataframe</span> <span class="kn">import</span> <span class="n">expressions</span>
<span class="kn">from</span> <span class="nn">apache_beam.dataframe</span> <span class="kn">import</span> <span class="n">frame_base</span>
<span class="kn">from</span> <span class="nn">apache_beam.dataframe</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">apache_beam.dataframe</span> <span class="kn">import</span> <span class="n">partitionings</span>


<div class="viewcode-block" id="populate_not_implemented"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.populate_not_implemented">[docs]</a><span class="k">def</span> <span class="nf">populate_not_implemented</span><span class="p">(</span><span class="n">pd_type</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">deferred_type</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">pd_type</span><span class="p">):</span>
      <span class="c1"># Don&#39;t auto-define hidden methods or dunders</span>
      <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
        <span class="k">continue</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">deferred_type</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="n">pd_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pd_type</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pd_value</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span> <span class="ow">or</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">pd_value</span><span class="p">):</span>
          <span class="c1"># Some of the properties on pandas types (cat, dt, sparse), are</span>
          <span class="c1"># actually attributes with class values, not properties</span>
          <span class="nb">setattr</span><span class="p">(</span>
              <span class="n">deferred_type</span><span class="p">,</span>
              <span class="n">attr</span><span class="p">,</span>
              <span class="nb">property</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">not_implemented_method</span><span class="p">(</span><span class="n">attr</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">pd_value</span><span class="p">):</span>
          <span class="nb">setattr</span><span class="p">(</span><span class="n">deferred_type</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">not_implemented_method</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">deferred_type</span>

  <span class="k">return</span> <span class="n">wrapper</span></div>


<div class="viewcode-block" id="DeferredDataFrameOrSeries"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrameOrSeries">[docs]</a><span class="k">class</span> <span class="nc">DeferredDataFrameOrSeries</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span>
        <span class="s1">&#39;Conversion to a non-deferred a numpy array.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrameOrSeries.droplevel"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrameOrSeries.droplevel">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">droplevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;droplevel&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;column&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrameOrSeries.fillna"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrameOrSeries.fillna">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">fillna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredBase</span><span class="p">):</span>
      <span class="n">value_expr</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_expr</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">value_expr</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ConstantExpression</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="c1"># yapf: disable</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;fillna&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span>
            <span class="n">value</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">value_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrameOrSeries.ffill"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrameOrSeries.ffill">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">ffill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

  <span class="n">pad</span> <span class="o">=</span> <span class="n">ffill</span>

<div class="viewcode-block" id="DeferredDataFrameOrSeries.groupby"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrameOrSeries.groupby">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">as_index</span><span class="p">,</span> <span class="n">group_keys</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_index</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;groupby(as_index=False)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">group_keys</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;groupby(group_keys=False)&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">_DeferredGroupByCols</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;groupbycols&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;You have to supply one of &#39;by&#39; and &#39;level&#39;&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">level</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">level</span><span class="p">]</span>
      <span class="n">all_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
      <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">]</span>
      <span class="n">levels_to_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">levels_to_drop</span><span class="p">:</span>
        <span class="n">to_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">levels_to_drop</span><span class="p">)</span><span class="o">.</span><span class="n">_expr</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">to_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span>

    <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">by</span><span class="p">):</span>

      <span class="k">def</span> <span class="nf">map_index</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

      <span class="n">to_group</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
          <span class="s1">&#39;map_index&#39;</span><span class="p">,</span>
          <span class="n">map_index</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
          <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
          <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">())</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">DeferredSeries</span><span class="p">):</span>

      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
          <span class="s2">&quot;grouping by a Series is not yet implemented. You can group by a &quot;</span>
          <span class="s2">&quot;DataFrame column by specifying its name.&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order sensitive&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DeferredDataFrame</span><span class="p">):</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="n">by</span><span class="p">]</span>
      <span class="n">index_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
      <span class="n">index_names_in_by</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">index_names</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">index_names_in_by</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">index_names</span><span class="p">):</span>
          <span class="n">to_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">index_names</span><span class="p">):</span>
          <span class="n">to_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">index_names</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">by</span><span class="p">))</span><span class="o">.</span><span class="n">_expr</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">to_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">index_names_in_by</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">_expr</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">to_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">_expr</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">DeferredGroupBy</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;groupbyindex&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
                <span class="n">level</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span><span class="p">)),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="n">to_group</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()),</span>
        <span class="n">kwargs</span><span class="p">,</span>
        <span class="n">to_group</span><span class="p">)</span></div>

  <span class="nb">abs</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">)</span>
  <span class="n">astype</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;astype&#39;</span><span class="p">)</span>
  <span class="n">copy</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">dtype</span>

  <span class="n">dtypes</span> <span class="o">=</span> <span class="n">dtype</span>

  <span class="k">def</span> <span class="nf">_get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_DeferredIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="n">index</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
      <span class="n">_get_index</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">not_implemented_method</span><span class="p">(</span><span class="s1">&#39;index (setter)&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="DeferredSeries"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries">[docs]</a><span class="nd">@populate_not_implemented</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
<span class="nd">@frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">_register_for</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DeferredSeries</span><span class="p">(</span><span class="n">DeferredDataFrameOrSeries</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_is_null_slice</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">is</span> <span class="bp">Ellipsis</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span>

    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_is_integer_slice</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
          <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_should_fallback_to_positional</span><span class="p">():</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order sensitive&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">or</span> <span class="n">callable</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="c1"># yapf: disable</span>
              <span class="s1">&#39;getitem&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">DeferredSeries</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="c1"># yapf: disable</span>
              <span class="s1">&#39;getitem&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span>
              <span class="n">indexer</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">indexer</span><span class="p">],</span>
              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">(),</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>

    <span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">is_iterator</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">is_bool_indexer</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order sensitive&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># We could consider returning a deferred scalar, but that might</span>
      <span class="c1"># be more surprising than a clear error.</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;non-deferred&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredSeries.align"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.align">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;per-level align&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
    <span class="c1"># We&#39;re using pd.concat here as expressions don&#39;t yet support</span>
    <span class="c1"># multiple return values.</span>
    <span class="n">aligned</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;align&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">aligned</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aligned</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span></div>

  <span class="n">array</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred value&#39;</span><span class="p">))</span>

  <span class="n">rename</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;rename&#39;</span><span class="p">)</span>
  <span class="n">between</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;between&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredSeries.dot"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.dot">[docs]</a>  <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DeferredSeries</span><span class="p">):</span>
      <span class="n">right</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
          <span class="s1">&#39;to_dataframe&#39;</span><span class="p">,</span>
          <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
          <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
          <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">())</span>
      <span class="n">right_is_series</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DeferredDataFrame</span><span class="p">):</span>
      <span class="n">right</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_expr</span>
      <span class="n">right_is_series</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;non-deferred result&#39;</span><span class="p">)</span>

    <span class="n">dots</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;dot&#39;</span><span class="p">,</span>
        <span class="c1"># Transpose so we can sum across rows.</span>
        <span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left</span> <span class="o">@</span> <span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
        <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="n">sums</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
          <span class="s1">&#39;sum&#39;</span><span class="p">,</span>
          <span class="k">lambda</span> <span class="n">dots</span><span class="p">:</span> <span class="n">dots</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>  <span class="c1">#</span>
          <span class="p">[</span><span class="n">dots</span><span class="p">],</span>
          <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">())</span>

      <span class="k">if</span> <span class="n">right_is_series</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;extract&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">sums</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">())</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sums</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

  <span class="fm">__matmul__</span> <span class="o">=</span> <span class="n">dot</span>

<div class="viewcode-block" id="DeferredSeries.std"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.std">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">skipna</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">ddof</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;per-level aggregation&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">skipna</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">skipna</span><span class="p">:</span>
      <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>  <span class="c1"># pylint: disable=self-cls-assignment</span>

    <span class="c1"># See the online, numerically stable formulae at</span>
    <span class="c1"># https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#Parallel_algorithm</span>
    <span class="c1"># and</span>
    <span class="c1"># https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#Welford&#39;s_online_algorithm</span>
    <span class="k">def</span> <span class="nf">compute_moments</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
      <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="n">m</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span>
      <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">combine_moments</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
      <span class="n">m</span> <span class="o">=</span> <span class="n">s</span> <span class="o">=</span> <span class="n">n</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">datum</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">delta</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="n">n</span> <span class="o">-</span> <span class="n">datum</span><span class="o">.</span><span class="n">s</span> <span class="o">/</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span>
          <span class="n">m</span> <span class="o">+=</span> <span class="n">datum</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="n">delta</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
          <span class="n">s</span> <span class="o">+=</span> <span class="n">datum</span><span class="o">.</span><span class="n">s</span>
          <span class="n">n</span> <span class="o">+=</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">ddof</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">ddof</span><span class="p">))</span>

    <span class="n">moments</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;compute_moments&#39;</span><span class="p">,</span>
        <span class="n">compute_moments</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;combine_moments&#39;</span><span class="p">,</span>
              <span class="n">combine_moments</span><span class="p">,</span> <span class="p">[</span><span class="n">moments</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredSeries.corr"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.corr">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;pearson&#39;</span><span class="p">:</span>  <span class="c1"># Note that this is the default.</span>
      <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">_corr_aligned</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># The rank-based correlations are not obviously parallelizable, though</span>
      <span class="c1"># perhaps an approximation could be done with a knowledge of quantiles</span>
      <span class="c1"># and custom partitioning.</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;corr&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span>
              <span class="n">other</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">min_periods</span><span class="p">),</span>
              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

  <span class="k">def</span> <span class="nf">_corr_aligned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">):</span>
    <span class="n">std_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">std_y</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_aligned</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cov</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">cov</span><span class="p">,</span> <span class="n">std_x</span><span class="p">,</span> <span class="n">std_y</span><span class="p">:</span> <span class="n">cov</span> <span class="o">/</span> <span class="p">(</span><span class="n">std_x</span> <span class="o">*</span> <span class="n">std_y</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">std_x</span><span class="p">,</span> <span class="n">std_y</span><span class="p">])</span>

<div class="viewcode-block" id="DeferredSeries.cov"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.cov">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">cov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">,</span> <span class="n">ddof</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">_cov_aligned</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">,</span> <span class="n">ddof</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">_cov_aligned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Use the formulae from</span>
    <span class="c1"># https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#Covariance</span>
    <span class="k">def</span> <span class="nf">compute_co_moments</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
      <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
      <span class="n">sx</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
      <span class="n">sy</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">sx</span><span class="o">=</span><span class="p">[</span><span class="n">sx</span><span class="p">],</span> <span class="n">sy</span><span class="o">=</span><span class="p">[</span><span class="n">sy</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">combine_co_moments</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">sx</span> <span class="o">=</span> <span class="n">sy</span> <span class="o">=</span> <span class="n">n</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">c</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">datum</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">datum</span><span class="o">.</span><span class="n">sx</span><span class="p">,</span> <span class="n">datum</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">c</span> <span class="o">+=</span> <span class="p">(</span>
              <span class="n">datum</span><span class="o">.</span><span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">sx</span> <span class="o">/</span> <span class="n">n</span> <span class="o">-</span> <span class="n">datum</span><span class="o">.</span><span class="n">sx</span> <span class="o">/</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span>
              <span class="p">(</span><span class="n">sy</span> <span class="o">/</span> <span class="n">n</span> <span class="o">-</span> <span class="n">datum</span><span class="o">.</span><span class="n">sy</span> <span class="o">/</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
          <span class="n">sx</span> <span class="o">+=</span> <span class="n">datum</span><span class="o">.</span><span class="n">sx</span>
          <span class="n">sy</span> <span class="o">+=</span> <span class="n">datum</span><span class="o">.</span><span class="n">sy</span>
          <span class="n">n</span> <span class="o">+=</span> <span class="n">datum</span><span class="o">.</span><span class="n">n</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">ddof</span><span class="p">,</span> <span class="n">min_periods</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">ddof</span><span class="p">)</span>

    <span class="n">moments</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;compute_co_moments&#39;</span><span class="p">,</span>
        <span class="n">compute_co_moments</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">())</span>

    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;combine_co_moments&#39;</span><span class="p">,</span>
              <span class="n">combine_co_moments</span><span class="p">,</span> <span class="p">[</span><span class="n">moments</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>

<div class="viewcode-block" id="DeferredSeries.dropna"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.dropna">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">dropna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;dropna&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()))</span></div>

  <span class="n">items</span> <span class="o">=</span> <span class="n">iteritems</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-lazy&#39;</span><span class="p">)</span>

  <span class="n">isin</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;isin&#39;</span><span class="p">)</span>

  <span class="n">isna</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;isna&#39;</span><span class="p">)</span>
  <span class="n">notnull</span> <span class="o">=</span> <span class="n">notna</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;notna&#39;</span><span class="p">)</span>

  <span class="n">to_numpy</span> <span class="o">=</span> <span class="n">to_string</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred value&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredSeries.aggregate"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.aggregate">[docs]</a>  <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="c1"># Aggregate each column separately, then stick them all together.</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">f</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">func</span><span class="p">]</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;join_aggregate&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="o">*</span><span class="n">rows</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">_expr</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># We&#39;re only handling a single column.</span>
      <span class="n">base_func</span> <span class="o">=</span> <span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">func</span>
      <span class="k">if</span> <span class="n">_is_associative</span><span class="p">(</span><span class="n">base_func</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">intermediate</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;pre_aggregate&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">base_func</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">())</span>
        <span class="n">allow_nonparallel_final</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">intermediate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span>
        <span class="n">allow_nonparallel_final</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># i.e. don&#39;t change the value</span>
      <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="n">allow_nonparallel_final</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
            <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
                <span class="s1">&#39;aggregate&#39;</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="n">intermediate</span><span class="p">],</span>
                <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
                <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

  <span class="n">agg</span> <span class="o">=</span> <span class="n">aggregate</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

  <span class="n">clip</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>

  <span class="nb">all</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
  <span class="nb">any</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
  <span class="nb">min</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
  <span class="nb">max</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
  <span class="n">prod</span> <span class="o">=</span> <span class="n">product</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;prod&#39;</span><span class="p">)</span>
  <span class="nb">sum</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

  <span class="n">cummax</span> <span class="o">=</span> <span class="n">cummin</span> <span class="o">=</span> <span class="n">cumsum</span> <span class="o">=</span> <span class="n">cumprod</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span>
      <span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
  <span class="n">diff</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>

  <span class="n">head</span> <span class="o">=</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>

  <span class="nb">filter</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">)</span>

  <span class="n">memory_usage</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred value&#39;</span><span class="p">)</span>

  <span class="c1"># In Series __contains__ checks the index</span>
  <span class="fm">__contains__</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred value&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredSeries.nlargest"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.nlargest">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">nlargest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># TODO(robertwb): Document &#39;any&#39; option.</span>
    <span class="c1"># TODO(robertwb): Consider (conditionally) defaulting to &#39;any&#39; if no</span>
    <span class="c1"># explicit keep parameter is requested.</span>
    <span class="k">if</span> <span class="n">keep</span> <span class="o">==</span> <span class="s1">&#39;any&#39;</span><span class="p">:</span>
      <span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span>
    <span class="k">elif</span> <span class="n">keep</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span>
    <span class="n">per_partition</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;nlargest-per-partition&#39;</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
        <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;nlargest&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="n">per_partition</span><span class="p">],</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredSeries.nsmallest"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.nsmallest">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">nsmallest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">keep</span> <span class="o">==</span> <span class="s1">&#39;any&#39;</span><span class="p">:</span>
      <span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span>
    <span class="k">elif</span> <span class="n">keep</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span>
    <span class="n">per_partition</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;nsmallest-per-partition&#39;</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
        <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;nsmallest&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="n">per_partition</span><span class="p">],</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

  <span class="n">plot</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">))</span>
  <span class="n">pop</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-lazy&#39;</span><span class="p">)</span>

  <span class="n">rename_axis</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;rename_axis&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredSeries.replace"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.replace">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;replace&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">))</span></div>

  <span class="nb">round</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

  <span class="n">searchsorted</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>

  <span class="n">shift</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>

  <span class="n">take</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;deprecated&#39;</span><span class="p">)</span>

  <span class="n">to_dict</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred&#39;</span><span class="p">)</span>

  <span class="n">to_frame</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;to_frame&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredSeries.unique"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.unique">[docs]</a>  <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_series</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_series</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span>
          <span class="s1">&#39;pass as_series=True to get the result as a (deferred) Series&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;unique&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredSeries.update"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredSeries.update">[docs]</a>  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;update&#39;</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span>
        <span class="n">other</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">or</span> <span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
        <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">())</span></div>

  <span class="n">unstack</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred column values&#39;</span><span class="p">)</span>

  <span class="n">values</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred&#39;</span><span class="p">))</span>

  <span class="n">view</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;memory sharing semantics&#39;</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_DeferredStringMethods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">)</span>

  <span class="n">apply</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;apply&#39;</span><span class="p">)</span>
  <span class="nb">map</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">)</span></div>
  <span class="c1"># TODO(BEAM-11636): Implement transform using type inference to determine the</span>
  <span class="c1"># proxy</span>
  <span class="c1">#transform = frame_base._elementwise_method(&#39;transform&#39;)</span>


<div class="viewcode-block" id="DeferredDataFrame"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame">[docs]</a><span class="nd">@populate_not_implemented</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
<span class="nd">@frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">_register_for</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DeferredDataFrame</span><span class="p">(</span><span class="n">DeferredDataFrameOrSeries</span><span class="p">):</span>
  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span>

  <span class="nd">@columns</span><span class="o">.</span><span class="n">setter</span>
  <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
      <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
      <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
      <span class="k">return</span> <span class="n">df</span>

    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;set_columns&#39;</span><span class="p">,</span>
            <span class="n">set_columns</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>

  <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="c1"># Column attribute access.</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

  <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="c1"># TODO: Replicate pd.DataFrame.__getitem__ logic</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">DeferredSeries</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredBase</span><span class="p">):</span>
      <span class="c1"># Fail early if key is a DeferredBase as it interacts surprisingly with</span>
      <span class="c1"># key in self._expr.proxy().columns</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
          <span class="s2">&quot;Indexing with a non-bool deferred frame is not yet supported. &quot;</span>
          <span class="s2">&quot;Consider using df.loc[...]&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">_is_null_slice</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
      <span class="k">elif</span> <span class="n">_is_integer_slice</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="c1"># This depends on the contents of the index.</span>
        <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span>
            <span class="s1">&#39;Use iloc or loc with integer slices.&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">elif</span> <span class="p">(</span>
        <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">key_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span>
                                       <span class="k">for</span> <span class="n">key_column</span> <span class="ow">in</span> <span class="n">key</span><span class="p">))</span> <span class="ow">or</span>
        <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elementwise</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">&#39;get_column&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

  <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="c1"># Checks if proxy has the given column</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

  <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
                      <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">key</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">DeferredSeries</span><span class="p">)</span> <span class="ow">and</span>
                                             <span class="n">key</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">):</span>
      <span class="c1"># yapf: disable</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elementwise</span><span class="p">(</span>
          <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
          <span class="s1">&#39;set_column&#39;</span><span class="p">,</span>
          <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
          <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrame.align"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.align">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">copy</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;align(copy=False)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;align(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="c1"># Could probably get by partitioning on the used levels.</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;align&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">,</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.set_index"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.set_index">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">set_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
      <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
          <span class="s1">&#39;set_index&#39;</span><span class="p">,</span>
          <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
          <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
          <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()))</span></div>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">loc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_DeferredLoc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">iloc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_DeferredILoc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">dtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">dtypes</span>

<div class="viewcode-block" id="DeferredDataFrame.assign"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.assign">[docs]</a>  <span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DeferredSeries</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s2">&quot;Unsupported value for new &quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;column &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: &#39;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                                            <span class="s2">&quot;Only callables and Series &quot;</span>
                                            <span class="s2">&quot;instances are supported.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;assign&#39;</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeferredDataFrame.explode"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.explode">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">ignore_index</span><span class="p">):</span>
    <span class="c1"># ignoring the index will not preserve it</span>
    <span class="n">preserves</span> <span class="o">=</span> <span class="p">(</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span> <span class="k">if</span> <span class="n">ignore_index</span>
                 <span class="k">else</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;explode&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">ignore_index</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">preserves</span><span class="p">,</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()))</span></div>


<div class="viewcode-block" id="DeferredDataFrame.drop"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.drop">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot specify both &#39;labels&#39; and &#39;index&#39;/&#39;columns&#39;&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="k">elif</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">labels</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axis must be one of (0, 1, &#39;index&#39;, &#39;columns&#39;), &quot;</span>
                         <span class="s2">&quot;got &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">axis</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="c1"># Compute the proxy based on just the columns that are dropped.</span>
      <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">errors</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
      <span class="c1"># In order to raise an error about missing index values, we&#39;ll</span>
      <span class="c1"># need to collect the entire dataframe.</span>
      <span class="n">requires</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;drop&#39;</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
                           <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
        <span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires</span><span class="p">))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.aggregate"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.aggregate">[docs]</a>  <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="c1"># Aggregate across all elements by first aggregating across columns,</span>
      <span class="c1"># then across rows.</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
          <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">):</span>
      <span class="c1"># This is an easy elementwise aggregation.</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;aggregate&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()))</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">args</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">:</span>
      <span class="c1"># For these corner cases, just colocate everything.</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;aggregate&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># In the general case, compute the aggregation of each column separately,</span>
      <span class="c1"># then recombine.</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">func</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_names</span><span class="p">}</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
      <span class="n">aggregated_cols</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_names</span><span class="p">:</span>
        <span class="n">funcs</span> <span class="o">=</span> <span class="n">func</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
          <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcs</span><span class="p">]</span>
        <span class="n">aggregated_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
      <span class="c1"># The final shape is different depending on whether any of the columns</span>
      <span class="c1"># were aggregated by a list of aggregators.</span>
      <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">funcs</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
          <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
              <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
                  <span class="s1">&#39;join_aggregate&#39;</span><span class="p">,</span>
                  <span class="k">lambda</span> <span class="o">*</span><span class="n">cols</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                      <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">col_names</span><span class="p">,</span> <span class="n">cols</span><span class="p">)}),</span>
                  <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">_expr</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">aggregated_cols</span><span class="p">],</span>
                  <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
            <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
                <span class="s1">&#39;join_aggregate&#39;</span><span class="p">,</span>
                  <span class="k">lambda</span> <span class="o">*</span><span class="n">cols</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                      <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">col_names</span><span class="p">,</span> <span class="n">cols</span><span class="p">)}),</span>
                <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">_expr</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">aggregated_cols</span><span class="p">],</span>
                <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
                <span class="n">proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)))</span></div>

  <span class="n">agg</span> <span class="o">=</span> <span class="n">aggregate</span>

  <span class="n">applymap</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;applymap&#39;</span><span class="p">)</span>

  <span class="n">memory_usage</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred value&#39;</span><span class="p">)</span>
  <span class="n">info</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred value&#39;</span><span class="p">)</span>

  <span class="nb">all</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
  <span class="nb">any</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>

  <span class="n">clip</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span>
      <span class="s1">&#39;clip&#39;</span><span class="p">,</span> <span class="n">restrictions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">axis</span><span class="p">:</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)})</span>

<div class="viewcode-block" id="DeferredDataFrame.corr"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.corr">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;pearson&#39;</span><span class="p">:</span>
      <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
      <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
      <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">arg_indices</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">col1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">col2</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
          <span class="n">arg_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">))</span>
          <span class="c1"># Note that this set may be different for each pair.</span>
          <span class="n">no_na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="p">[</span><span class="n">col2</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
          <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
              <span class="n">no_na</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span><span class="o">.</span><span class="n">_corr_aligned</span><span class="p">(</span><span class="n">no_na</span><span class="p">[</span><span class="n">col2</span><span class="p">],</span> <span class="n">min_periods</span><span class="p">))</span>
      <span class="k">def</span> <span class="nf">fill_matrix</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
          <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arg_indices</span><span class="p">):</span>
          <span class="n">data</span><span class="p">[</span><span class="n">col1</span><span class="p">][</span><span class="n">col2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col2</span><span class="p">][</span><span class="n">col1</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
      <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
            <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
                <span class="s1">&#39;fill_matrix&#39;</span><span class="p">,</span>
                <span class="n">fill_matrix</span><span class="p">,</span>
                <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">_expr</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">],</span>
                <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
                <span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;corr&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">min_periods</span><span class="p">),</span>
              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.cov"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.cov">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">cov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_periods</span><span class="p">,</span> <span class="n">ddof</span><span class="p">):</span>
    <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">arg_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
      <span class="n">arg_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
      <span class="n">std</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="p">)</span>
      <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;square&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">col1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">col2</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">arg_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">))</span>
        <span class="c1"># Note that this set may be different for each pair.</span>
        <span class="n">no_na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="p">[</span><span class="n">col2</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">no_na</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span><span class="o">.</span><span class="n">_cov_aligned</span><span class="p">(</span><span class="n">no_na</span><span class="p">[</span><span class="n">col2</span><span class="p">],</span> <span class="n">min_periods</span><span class="p">,</span> <span class="n">ddof</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">fill_matrix</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arg_indices</span><span class="p">):</span>
        <span class="n">data</span><span class="p">[</span><span class="n">col1</span><span class="p">][</span><span class="n">col2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col2</span><span class="p">][</span><span class="n">col1</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
      <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;fill_matrix&#39;</span><span class="p">,</span>
              <span class="n">fill_matrix</span><span class="p">,</span>
              <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">_expr</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
              <span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.corrwith"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.corrwith">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">corrwith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">drop</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;corrwith(axis=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="p">):</span>
      <span class="n">other</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ConstantExpression</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DeferredSeries</span><span class="p">):</span>
      <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
      <span class="n">col_names</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">index</span>
      <span class="n">other_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_names</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DeferredDataFrame</span><span class="p">):</span>
      <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span>
          <span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
      <span class="n">col_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
          <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
          <span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
          <span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
      <span class="n">other_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">col_names</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Raise the right error.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">())</span>
      <span class="c1"># Just in case something else becomes valid.</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;corrwith(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">))</span>

    <span class="c1"># Generate expressions to compute the actual correlations.</span>
    <span class="n">corrs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">other_col</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">other_col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">col_names</span><span class="p">,</span> <span class="n">other_cols</span><span class="p">)]</span>

    <span class="c1"># Combine the results</span>
    <span class="k">def</span> <span class="nf">fill_dataframe</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
          <span class="s1">&#39;fill_dataframe&#39;</span><span class="p">,</span>
          <span class="n">fill_dataframe</span><span class="p">,</span>
          <span class="p">[</span><span class="n">corr</span><span class="o">.</span><span class="n">_expr</span> <span class="k">for</span> <span class="n">corr</span> <span class="ow">in</span> <span class="n">corrs</span><span class="p">],</span>
          <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
          <span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">))</span></div>



  <span class="n">cummax</span> <span class="o">=</span> <span class="n">cummin</span> <span class="o">=</span> <span class="n">cumsum</span> <span class="o">=</span> <span class="n">cumprod</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span>
      <span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
  <span class="n">diff</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrame.dot"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.dot">[docs]</a>  <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="c1"># We want to broadcast the right hand side to all partitions of the left.</span>
    <span class="c1"># This is OK, as its index must be the same size as the columns set of self,</span>
    <span class="c1"># so cannot be too large.</span>
    <span class="k">class</span> <span class="nc">AsScalar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
      <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="p">):</span>
      <span class="n">proxy</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span>
      <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">():</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;as_scalar&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">AsScalar</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
            <span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">proxy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
      <span class="n">side</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ConstantExpression</span><span class="p">(</span><span class="n">AsScalar</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;dot&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">left</span> <span class="o">@</span> <span class="n">right</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">side</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">(),</span>
            <span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">))</span></div>

  <span class="fm">__matmul__</span> <span class="o">=</span> <span class="n">dot</span>

  <span class="n">head</span> <span class="o">=</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>

  <span class="nb">max</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
  <span class="nb">min</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrame.mode"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.mode">[docs]</a>  <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;columns&#39;</span><span class="p">:</span>
      <span class="c1"># Number of columns is max(number mode values for each row), so we can&#39;t</span>
      <span class="c1"># determine how many there will be before looking at the data.</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;non-deferred column values&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="c1">#TODO(robertwb): Approximate?</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.dropna"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.dropna">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">dropna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># TODO(robertwb): This is a common pattern. Generalize?</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;columns&#39;</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;dropna&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">))</span></div>

  <span class="k">def</span> <span class="nf">_eval_or_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;local_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;global_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;resolvers&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; is not yet supported&quot;</span><span class="p">)</span>

    <span class="c1"># look for &#39;@&lt;py identifier&gt;&#39;</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\@[^\d\W]\w*&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Accessing locals with @ is not yet supported &quot;</span>
                                <span class="s2">&quot;(BEAM-11202)&quot;</span><span class="p">)</span>

    <span class="n">result_expr</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="p">)(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
        <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="o">=</span> <span class="n">result_expr</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">result_expr</span><span class="p">)</span>


<div class="viewcode-block" id="DeferredDataFrame.eval"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.eval">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_or_query</span><span class="p">(</span><span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeferredDataFrame.query"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.query">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_or_query</span><span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

  <span class="n">isna</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;isna&#39;</span><span class="p">)</span>
  <span class="n">notnull</span> <span class="o">=</span> <span class="n">notna</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;notna&#39;</span><span class="p">)</span>

  <span class="n">items</span> <span class="o">=</span> <span class="n">itertuples</span> <span class="o">=</span> <span class="n">iterrows</span> <span class="o">=</span> <span class="n">iteritems</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span>
      <span class="s1">&#39;non-lazy&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_cols_as_temporary_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">original_index_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
    <span class="n">new_index_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;__apache_beam_temp_</span><span class="si">%d</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">original_index_names</span><span class="p">)]</span>
    <span class="k">def</span> <span class="nf">reindex</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;reindex&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span>
                  <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">new_index_names</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span>
              <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()))</span>
    <span class="k">def</span> <span class="nf">revert</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;join_restoreindex&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span>
                  <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">new_index_names</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">original_index_names</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
              <span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">reindex</span><span class="p">,</span> <span class="n">revert</span>

<div class="viewcode-block" id="DeferredDataFrame.join"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.join">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">reindex</span><span class="p">,</span> <span class="n">revert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cols_as_temporary_index</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">revert</span><span class="p">(</span><span class="n">reindex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="n">other_is_list</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">other</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">]</span>
      <span class="n">other_is_list</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">placeholder</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
    <span class="n">other_exprs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">df</span><span class="o">.</span><span class="n">_expr</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">other</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="p">)]</span>
    <span class="n">const_others</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">placeholder</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">df</span>
        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">other</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">fill_placeholders</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
      <span class="n">values</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
      <span class="n">filled</span> <span class="o">=</span> <span class="p">[</span>
          <span class="nb">next</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="n">placeholder</span> <span class="k">else</span> <span class="n">df</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">const_others</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">other_is_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filled</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;join&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="o">*</span><span class="n">deferred_others</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">fill_placeholders</span><span class="p">(</span><span class="n">deferred_others</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">]</span> <span class="o">+</span> <span class="n">other_exprs</span><span class="p">,</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.merge"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.merge">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span>
      <span class="bp">self</span><span class="p">,</span>
      <span class="n">right</span><span class="p">,</span>
      <span class="n">on</span><span class="p">,</span>
      <span class="n">left_on</span><span class="p">,</span>
      <span class="n">right_on</span><span class="p">,</span>
      <span class="n">left_index</span><span class="p">,</span>
      <span class="n">right_index</span><span class="p">,</span>
      <span class="n">suffixes</span><span class="p">,</span>
      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">self_proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span>
    <span class="n">right_proxy</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span>
    <span class="c1"># Validate with a pandas call.</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">self_proxy</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">right_proxy</span><span class="p">,</span>
        <span class="n">on</span><span class="o">=</span><span class="n">on</span><span class="p">,</span>
        <span class="n">left_on</span><span class="o">=</span><span class="n">left_on</span><span class="p">,</span>
        <span class="n">right_on</span><span class="o">=</span><span class="n">right_on</span><span class="p">,</span>
        <span class="n">left_index</span><span class="o">=</span><span class="n">left_index</span><span class="p">,</span>
        <span class="n">right_index</span><span class="o">=</span><span class="n">right_index</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;how&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;cross&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;cross join is not yet implemented (BEAM-9547)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">on</span><span class="p">,</span> <span class="n">left_on</span><span class="p">,</span> <span class="n">right_on</span><span class="p">,</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">right_index</span><span class="p">]):</span>
      <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">self_proxy</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">right_proxy</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">left_on</span><span class="p">:</span>
      <span class="n">left_on</span> <span class="o">=</span> <span class="n">on</span>
    <span class="k">if</span> <span class="n">left_on</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left_on</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="n">left_on</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_on</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">right_on</span><span class="p">:</span>
      <span class="n">right_on</span> <span class="o">=</span> <span class="n">on</span>
    <span class="k">if</span> <span class="n">right_on</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right_on</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="n">right_on</span> <span class="o">=</span> <span class="p">[</span><span class="n">right_on</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">left_index</span><span class="p">:</span>
      <span class="n">indexed_left</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">indexed_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">left_on</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">right_index</span><span class="p">:</span>
      <span class="n">indexed_right</span> <span class="o">=</span> <span class="n">right</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">indexed_right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">right_on</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">left_on</span> <span class="ow">and</span> <span class="n">right_on</span><span class="p">:</span>
      <span class="n">common_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">left_on</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right_on</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_cols</span><span class="p">):</span>
        <span class="c1"># When merging on the same column name from both dfs, we need to make</span>
        <span class="c1"># sure only one df has the column. Otherwise we end up with</span>
        <span class="c1"># two duplicate columns, one with lsuffix and one with rsuffix.</span>
        <span class="c1"># It&#39;s safe to drop from either because the data has already been duped</span>
        <span class="c1"># to the index.</span>
        <span class="n">indexed_right</span> <span class="o">=</span> <span class="n">indexed_right</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">common_cols</span><span class="p">)</span>


    <span class="n">merged</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;merge&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">left</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span><span class="p">,</span>
                                           <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">suffixes</span><span class="o">=</span><span class="n">suffixes</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="n">indexed_left</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">indexed_right</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">left_index</span> <span class="ow">or</span> <span class="n">right_index</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">merged</span>
    <span class="k">else</span><span class="p">:</span>

      <span class="k">return</span> <span class="n">merged</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DeferredDataFrame.nlargest"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.nlargest">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">nlargest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">keep</span> <span class="o">==</span> <span class="s1">&#39;any&#39;</span><span class="p">:</span>
      <span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span>
    <span class="k">elif</span> <span class="n">keep</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span>
    <span class="n">per_partition</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;nlargest-per-partition&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;nlargest&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
              <span class="p">[</span><span class="n">per_partition</span><span class="p">],</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.nsmallest"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.nsmallest">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">nsmallest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">keep</span> <span class="o">==</span> <span class="s1">&#39;any&#39;</span><span class="p">:</span>
      <span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span>
    <span class="k">elif</span> <span class="n">keep</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span>
    <span class="n">per_partition</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;nsmallest-per-partition&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">expressions</span><span class="o">.</span><span class="n">allow_non_parallel_operations</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;nsmallest&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
              <span class="p">[</span><span class="n">per_partition</span><span class="p">],</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.nunique"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.nunique">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">nunique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">):</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;nunique&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">nunique</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">))</span></div>

  <span class="n">plot</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="DeferredDataFrame.pop"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.pop">[docs]</a>  <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;popped&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="n">df</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">result</span></div>

  <span class="n">prod</span> <span class="o">=</span> <span class="n">product</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;prod&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrame.quantile"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.quantile">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">quantile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;columns&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;non-deferred column values&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;quantile&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="c1">#TODO(robertwb): Approximate quantiles?</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.rename"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.rename">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">rename_index</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span>
        <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;columns&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;axis&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">))</span>
    <span class="n">rename_columns</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;columns&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span>
        <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">rename_index</span><span class="p">:</span>
      <span class="c1"># Technically, it&#39;s still partitioned by index, but it&#39;s no longer</span>
      <span class="c1"># partitioned by the hash of the index.</span>
      <span class="n">preserves_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">preserves_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span> <span class="ow">and</span> <span class="n">rename_index</span><span class="p">:</span>
      <span class="c1"># Renaming index with checking requires global index.</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>

    <span class="n">proxy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">rename_index</span><span class="p">:</span>
      <span class="c1"># The proxy can&#39;t be computed by executing rename, it will error</span>
      <span class="c1"># renaming the index.</span>
      <span class="k">if</span> <span class="n">rename_columns</span><span class="p">:</span>
        <span class="c1"># Note if both are being renamed, index and columns must be specified</span>
        <span class="c1"># (not axis)</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                             <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">})</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># No change in columns, reuse proxy</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;rename&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">preserves_partition_by</span><span class="p">,</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">))</span></div>

  <span class="n">rename_axis</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;rename_axis&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrame.replace"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.replace">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;replace&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">))</span></div>

<div class="viewcode-block" id="DeferredDataFrame.reset_index"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.reset_index">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">reset_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
      <span class="n">level</span> <span class="o">=</span> <span class="p">[</span><span class="n">level</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span><span class="p">:</span>
      <span class="c1"># TODO: Could do distributed re-index with offsets.</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;reset_index&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">))</span></div>

  <span class="nb">round</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>
  <span class="n">select_dtypes</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;select_dtypes&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrame.shift"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.shift">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;freq&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;data-dependent&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;columns&#39;</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;shift&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">))</span></div>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;scalar value&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrame.sort_values"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.sort_values">[docs]</a>  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">maybe_inplace</span>
  <span class="k">def</span> <span class="nf">sort_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;columns&#39;</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">requires_partition_by</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;sort_values&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(),</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires_partition_by</span><span class="p">))</span></div>

  <span class="n">stack</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;stack&#39;</span><span class="p">)</span>

  <span class="nb">sum</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_agg_method</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>

  <span class="n">take</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;deprecated&#39;</span><span class="p">)</span>

  <span class="n">to_records</span> <span class="o">=</span> <span class="n">to_dict</span> <span class="o">=</span> <span class="n">to_numpy</span> <span class="o">=</span> <span class="n">to_string</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred value&#39;</span><span class="p">))</span>

  <span class="n">to_sparse</span> <span class="o">=</span> <span class="n">to_string</span> <span class="c1"># frame_base._elementwise_method(&#39;to_sparse&#39;)</span>

  <span class="n">transpose</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred column values&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredDataFrame.unstack"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredDataFrame.unstack">[docs]</a>  <span class="k">def</span> <span class="nf">unstack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;unstack&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;non-deferred column values&#39;</span><span class="p">)</span></div>

  <span class="n">update</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_proxy_method</span><span class="p">(</span>
      <span class="s1">&#39;update&#39;</span><span class="p">,</span>
      <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
      <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">(),</span>
      <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">())</span>

  <span class="n">values</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred value&#39;</span><span class="p">))</span></div>


<span class="k">for</span> <span class="n">io_func</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">io</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">io_func</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;to_&#39;</span><span class="p">):</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredDataFrame</span><span class="p">,</span> <span class="n">io_func</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">io_func</span><span class="p">))</span>


<span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="p">):</span>
  <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredDataFrame</span><span class="p">,</span> <span class="n">meth</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="n">meth</span><span class="p">))</span>


<div class="viewcode-block" id="DeferredGroupBy"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredGroupBy">[docs]</a><span class="nd">@populate_not_implemented</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">groupby</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">DataFrameGroupBy</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DeferredGroupBy</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span>
               <span class="n">ungrouped</span><span class="p">:</span> <span class="n">DeferredDataFrameOrSeries</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">DeferredGroupBy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="c1"># This object represents the result of:</span>
    <span class="c1"># ungrouped.groupby(level=list(range(ungrouped.index.nlevels),</span>
    <span class="c1">#                   **kwargs)[projection]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ungrouped</span> <span class="o">=</span> <span class="n">ungrouped</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_projection</span> <span class="o">=</span> <span class="n">projection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

  <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DeferredGroupBy</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;groupby_project&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">gb</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">gb</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ungrouped</span><span class="p">,</span>
        <span class="n">name</span><span class="p">)</span>

  <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">DeferredGroupBy</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;groupby_project&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">gb</span><span class="p">:</span> <span class="n">gb</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ungrouped</span><span class="p">,</span>
        <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="DeferredGroupBy.agg"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.DeferredGroupBy.agg">[docs]</a>  <span class="k">def</span> <span class="nf">agg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
      <span class="c1"># TODO: Add support for strings in (UN)LIFTABLE_AGGREGATIONS. Test by</span>
      <span class="c1"># running doctests for pandas.core.groupby.generic</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;GroupBy.agg currently only supports callable &#39;</span>
                                <span class="s1">&#39;arguments&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DeferredDataFrame</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;agg&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">(),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span></div>

  <span class="n">aggregate</span> <span class="o">=</span> <span class="n">agg</span>

  <span class="n">first</span> <span class="o">=</span> <span class="n">last</span> <span class="o">=</span> <span class="n">head</span> <span class="o">=</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span>
      <span class="s1">&#39;order sensitive&#39;</span><span class="p">)</span>

  <span class="c1"># TODO(robertwb): Consider allowing this for categorical keys.</span>
  <span class="fm">__len__</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred&#39;</span><span class="p">)</span>
  <span class="n">groups</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;non-deferred&#39;</span><span class="p">))</span></div>

<span class="k">def</span> <span class="nf">_maybe_project_func</span><span class="p">(</span><span class="n">projection</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
  <span class="sd">&quot;&quot;&quot; Returns identity func if projection is empty or None, else returns</span>
<span class="sd">  a function that projects the specified columns. &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">projection</span><span class="p">:</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">projection</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">_liftable_agg</span><span class="p">(</span><span class="n">meth</span><span class="p">,</span> <span class="n">postagg_meth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="n">name</span><span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">name_and_func</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">postagg_meth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">post_agg_name</span><span class="p">,</span> <span class="n">post_agg_func</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">agg_func</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">post_agg_name</span><span class="p">,</span> <span class="n">post_agg_func</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">name_and_func</span><span class="p">(</span><span class="n">postagg_meth</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DeferredGroupBy</span><span class="p">)</span>

    <span class="n">to_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ungrouped</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
    <span class="n">is_categorical_grouping</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">to_group</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">is_categorical</span><span class="p">()</span>
                                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">to_group</span><span class="o">.</span><span class="n">nlevels</span><span class="p">))</span>
    <span class="n">groupby_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span>

    <span class="c1"># Don&#39;t include un-observed categorical values in the preagg</span>
    <span class="n">preagg_groupby_kwargs</span> <span class="o">=</span> <span class="n">groupby_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">preagg_groupby_kwargs</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">project</span> <span class="o">=</span> <span class="n">_maybe_project_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_projection</span><span class="p">)</span>
    <span class="n">pre_agg</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;pre_combine_&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">agg_func</span><span class="p">(</span><span class="n">project</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span><span class="p">)),</span>
                   <span class="o">**</span><span class="n">preagg_groupby_kwargs</span><span class="p">),</span>
        <span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ungrouped</span><span class="p">],</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
        <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">())</span>

    <span class="n">post_agg</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="s1">&#39;post_combine_&#39;</span> <span class="o">+</span> <span class="n">post_agg_name</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">post_agg_func</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span><span class="p">)),</span> <span class="o">**</span><span class="n">groupby_kwargs</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">[</span><span class="n">pre_agg</span><span class="p">],</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="p">(</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
                               <span class="k">if</span> <span class="n">is_categorical_grouping</span>
                               <span class="k">else</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()),</span>
        <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">post_agg</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">_unliftable_agg</span><span class="p">(</span><span class="n">meth</span><span class="p">):</span>
  <span class="n">name</span><span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">name_and_func</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DeferredGroupBy</span><span class="p">)</span>

    <span class="n">to_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ungrouped</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
    <span class="n">is_categorical_grouping</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">to_group</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">is_categorical</span><span class="p">()</span>
                                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">to_group</span><span class="o">.</span><span class="n">nlevels</span><span class="p">))</span>

    <span class="n">groupby_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span>
    <span class="n">project</span> <span class="o">=</span> <span class="n">_maybe_project_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_projection</span><span class="p">)</span>
    <span class="n">post_agg</span> <span class="o">=</span> <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">agg_func</span><span class="p">(</span><span class="n">project</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span><span class="p">)),</span>
                       <span class="o">**</span><span class="n">groupby_kwargs</span><span class="p">),</span>
            <span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ungrouped</span><span class="p">],</span>
        <span class="n">requires_partition_by</span><span class="o">=</span><span class="p">(</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
                               <span class="k">if</span> <span class="n">is_categorical_grouping</span>
                               <span class="k">else</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()),</span>
        <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">post_agg</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">wrapper</span>

<span class="n">LIFTABLE_AGGREGATIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;prod&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]</span>
<span class="n">LIFTABLE_WITH_SUM_AGGREGATIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">UNLIFTABLE_AGGREGATIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">LIFTABLE_AGGREGATIONS</span><span class="p">:</span>
  <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredGroupBy</span><span class="p">,</span> <span class="n">meth</span><span class="p">,</span> <span class="n">_liftable_agg</span><span class="p">(</span><span class="n">meth</span><span class="p">))</span>
<span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">LIFTABLE_WITH_SUM_AGGREGATIONS</span><span class="p">:</span>
  <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredGroupBy</span><span class="p">,</span> <span class="n">meth</span><span class="p">,</span> <span class="n">_liftable_agg</span><span class="p">(</span><span class="n">meth</span><span class="p">,</span> <span class="n">postagg_meth</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">meth</span> <span class="ow">in</span> <span class="n">UNLIFTABLE_AGGREGATIONS</span><span class="p">:</span>
  <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredGroupBy</span><span class="p">,</span> <span class="n">meth</span><span class="p">,</span> <span class="n">_unliftable_agg</span><span class="p">(</span><span class="n">meth</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_is_associative</span><span class="p">(</span><span class="n">agg_func</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">agg_func</span> <span class="ow">in</span> <span class="n">LIFTABLE_AGGREGATIONS</span> <span class="ow">or</span> <span class="p">(</span>
      <span class="nb">getattr</span><span class="p">(</span><span class="n">agg_func</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">LIFTABLE_AGGREGATIONS</span>
      <span class="ow">and</span> <span class="n">agg_func</span><span class="o">.</span><span class="vm">__module__</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="s1">&#39;builtins&#39;</span><span class="p">))</span>



<span class="nd">@populate_not_implemented</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">groupby</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">DataFrameGroupBy</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_DeferredGroupByCols</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="p">):</span>
  <span class="c1"># It&#39;s not clear that all of these make sense in Pandas either...</span>
  <span class="n">agg</span> <span class="o">=</span> <span class="n">aggregate</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;agg&#39;</span><span class="p">)</span>
  <span class="nb">any</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
  <span class="nb">all</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
  <span class="n">boxplot</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">)</span>
  <span class="n">describe</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;describe&#39;</span><span class="p">)</span>
  <span class="n">diff</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;diff&#39;</span><span class="p">)</span>
  <span class="n">fillna</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;fillna&#39;</span><span class="p">)</span>
  <span class="nb">filter</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;filter&#39;</span><span class="p">)</span>
  <span class="n">first</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order sensitive&#39;</span><span class="p">)</span>
  <span class="n">get_group</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>
  <span class="n">head</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order sensitive&#39;</span><span class="p">)</span>
  <span class="n">hist</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">)</span>
  <span class="n">idxmax</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;idxmax&#39;</span><span class="p">)</span>
  <span class="n">idxmin</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;idxmin&#39;</span><span class="p">)</span>
  <span class="n">last</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order sensitive&#39;</span><span class="p">)</span>
  <span class="n">mad</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;mad&#39;</span><span class="p">)</span>
  <span class="nb">max</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
  <span class="n">mean</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
  <span class="n">median</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
  <span class="nb">min</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
  <span class="n">nunique</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
  <span class="n">plot</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">)</span>
  <span class="n">prod</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;prod&#39;</span><span class="p">)</span>
  <span class="n">quantile</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;quantile&#39;</span><span class="p">)</span>
  <span class="n">shift</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;shift&#39;</span><span class="p">)</span>
  <span class="n">size</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">)</span>
  <span class="n">skew</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;skew&#39;</span><span class="p">)</span>
  <span class="n">std</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;std&#39;</span><span class="p">)</span>
  <span class="nb">sum</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
  <span class="n">tail</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;order sensitive&#39;</span><span class="p">)</span>
  <span class="n">take</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;deprectated&#39;</span><span class="p">)</span>
  <span class="n">tshift</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;tshift&#39;</span><span class="p">)</span>
  <span class="n">var</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">groups</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">indices</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">ndim</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">ngroups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">ngroups</span>


<span class="nd">@populate_not_implemented</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Index</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_DeferredIndex</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="n">frame</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">ndim</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">nlevels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">nlevels</span>

  <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;index.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>


<span class="nd">@populate_not_implemented</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexing</span><span class="o">.</span><span class="n">_LocIndexer</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_DeferredLoc</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="n">frame</span>

  <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
      <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">index</span>
      <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">rows</span><span class="p">][</span><span class="n">cols</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">bool</span><span class="p">):</span>
      <span class="c1"># Aligned by numerical index.</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="c1"># Select rows, but behaves poorly on missing values.</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
      <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">_expr</span><span class="p">]</span>
      <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="p">):</span>
      <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">_expr</span><span class="p">]</span>
      <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>

      <span class="k">def</span> <span class="nf">checked_callable_index</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="n">computed_index</span> <span class="o">=</span> <span class="n">index</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">computed_index</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
          <span class="n">row_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">computed_index</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">row_index</span> <span class="o">=</span> <span class="n">computed_index</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">row_index</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">row_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">bool</span><span class="p">):</span>
          <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">row_index</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="p">(</span><span class="nb">slice</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
          <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">row_index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">computed_index</span>

      <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">_expr</span><span class="p">]</span>
      <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">checked_callable_index</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;loc&#39;</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">args</span><span class="p">,</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="p">(</span>
                <span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                <span class="k">else</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">()),</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>

  <span class="fm">__setitem__</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">not_implemented_method</span><span class="p">(</span><span class="s1">&#39;loc.setitem&#39;</span><span class="p">)</span>

<span class="nd">@populate_not_implemented</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexing</span><span class="o">.</span><span class="n">_iLocIndexer</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_DeferredILoc</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="n">frame</span>

  <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
      <span class="n">rows</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">index</span>
      <span class="k">if</span> <span class="n">rows</span> <span class="o">!=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;iloc&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s1">&#39;order-sensitive&#39;</span><span class="p">)</span>

  <span class="fm">__setitem__</span> <span class="o">=</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">wont_implement_method</span><span class="p">(</span><span class="s1">&#39;iloc.setitem&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_DeferredStringMethods</span><span class="p">(</span><span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredBase</span><span class="p">):</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">StringMethods</span><span class="p">)</span>
  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">populate_defaults</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">StringMethods</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">others</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">others</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="c1"># Concatenate series into a single String</span>
      <span class="n">requires</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()</span>
      <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">join</span><span class="o">=</span><span class="n">join</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">]</span>

    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">others</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredBase</span><span class="p">)</span> <span class="ow">or</span>
         <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">others</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span>
          <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredBase</span><span class="p">)</span> <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">))):</span>
      <span class="k">if</span> <span class="n">join</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s2">&quot;cat with others=Series or &quot;</span>
                                            <span class="s2">&quot;others=List[Series] requires &quot;</span>
                                            <span class="s2">&quot;join to be specified.&quot;</span><span class="p">)</span>

      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">others</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredBase</span><span class="p">):</span>
        <span class="n">others</span> <span class="o">=</span> <span class="p">[</span><span class="n">others</span><span class="p">]</span>

      <span class="n">requires</span> <span class="o">=</span> <span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">()</span>
      <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">others</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">join</span><span class="o">=</span><span class="n">join</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">other</span><span class="o">.</span><span class="n">_expr</span> <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">others</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s2">&quot;others must be None, Series, or &quot;</span>
                                          <span class="s2">&quot;List[Series]. List[str] is not &quot;</span>
                                          <span class="s2">&quot;supported.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
            <span class="s1">&#39;cat&#39;</span><span class="p">,</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">args</span><span class="p">,</span>
            <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">requires</span><span class="p">,</span>
            <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>

  <span class="nd">@frame_base</span><span class="o">.</span><span class="n">args_to_kwargs</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">StringMethods</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">repeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repeats</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">repeats</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;repeat&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">series</span><span class="p">:</span> <span class="n">series</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeats</span><span class="p">),</span>
              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="c1"># TODO(BEAM-11155): Defer to pandas to compute this proxy.</span>
              <span class="c1"># Currently it incorrectly infers dtype bool, may require upstream</span>
              <span class="c1"># fix.</span>
              <span class="n">proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">(),</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Nothing</span><span class="p">(),</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">repeats</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredBase</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">DeferredFrame</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span>
          <span class="n">expressions</span><span class="o">.</span><span class="n">ComputedExpression</span><span class="p">(</span>
              <span class="s1">&#39;repeat&#39;</span><span class="p">,</span>
              <span class="k">lambda</span> <span class="n">series</span><span class="p">,</span> <span class="n">repeats_series</span><span class="p">:</span> <span class="n">series</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repeats_series</span><span class="p">),</span>
              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="p">,</span> <span class="n">repeats</span><span class="o">.</span><span class="n">_expr</span><span class="p">],</span>
              <span class="c1"># TODO(BEAM-11155): Defer to pandas to compute this proxy.</span>
              <span class="c1"># Currently it incorrectly infers dtype bool, may require upstream</span>
              <span class="c1"># fix.</span>
              <span class="n">proxy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_expr</span><span class="o">.</span><span class="n">proxy</span><span class="p">(),</span>
              <span class="n">requires_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Index</span><span class="p">(),</span>
              <span class="n">preserves_partition_by</span><span class="o">=</span><span class="n">partitionings</span><span class="o">.</span><span class="n">Singleton</span><span class="p">()))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">repeats</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">WontImplementError</span><span class="p">(</span><span class="s2">&quot;repeats must be an integer or a &quot;</span>
                                          <span class="s2">&quot;Series.&quot;</span><span class="p">)</span>


<span class="n">ELEMENTWISE_STRING_METHODS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;capitalize&#39;</span><span class="p">,</span>
            <span class="s1">&#39;casefold&#39;</span><span class="p">,</span>
            <span class="s1">&#39;contains&#39;</span><span class="p">,</span>
            <span class="s1">&#39;count&#39;</span><span class="p">,</span>
            <span class="s1">&#39;endswith&#39;</span><span class="p">,</span>
            <span class="s1">&#39;extract&#39;</span><span class="p">,</span>
            <span class="s1">&#39;extractall&#39;</span><span class="p">,</span>
            <span class="s1">&#39;findall&#39;</span><span class="p">,</span>
            <span class="s1">&#39;fullmatch&#39;</span><span class="p">,</span>
            <span class="s1">&#39;get&#39;</span><span class="p">,</span>
            <span class="s1">&#39;get_dummies&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isalnum&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isalpha&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isdecimal&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isdigit&#39;</span><span class="p">,</span>
            <span class="s1">&#39;islower&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isnumeric&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isspace&#39;</span><span class="p">,</span>
            <span class="s1">&#39;istitle&#39;</span><span class="p">,</span>
            <span class="s1">&#39;isupper&#39;</span><span class="p">,</span>
            <span class="s1">&#39;join&#39;</span><span class="p">,</span>
            <span class="s1">&#39;len&#39;</span><span class="p">,</span>
            <span class="s1">&#39;lower&#39;</span><span class="p">,</span>
            <span class="s1">&#39;lstrip&#39;</span><span class="p">,</span>
            <span class="s1">&#39;match&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pad&#39;</span><span class="p">,</span>
            <span class="s1">&#39;partition&#39;</span><span class="p">,</span>
            <span class="s1">&#39;replace&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rpartition&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rsplit&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rstrip&#39;</span><span class="p">,</span>
            <span class="s1">&#39;slice&#39;</span><span class="p">,</span>
            <span class="s1">&#39;slice_replace&#39;</span><span class="p">,</span>
            <span class="s1">&#39;split&#39;</span><span class="p">,</span>
            <span class="s1">&#39;startswith&#39;</span><span class="p">,</span>
            <span class="s1">&#39;strip&#39;</span><span class="p">,</span>
            <span class="s1">&#39;swapcase&#39;</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span><span class="p">,</span>
            <span class="s1">&#39;upper&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wrap&#39;</span><span class="p">,</span>
            <span class="s1">&#39;zfill&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__getitem__&#39;</span><span class="p">,</span>
<span class="p">]</span>

<div class="viewcode-block" id="make_str_func"><a class="viewcode-back" href="../../../apache_beam.dataframe.frames.html#apache_beam.dataframe.frames.make_str_func">[docs]</a><span class="k">def</span> <span class="nf">make_str_func</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">str</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">func</span></div>

<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">ELEMENTWISE_STRING_METHODS</span><span class="p">:</span>
  <span class="nb">setattr</span><span class="p">(</span><span class="n">_DeferredStringMethods</span><span class="p">,</span>
          <span class="n">method</span><span class="p">,</span>
          <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="n">make_str_func</span><span class="p">(</span><span class="n">method</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">,</span>
             <span class="s1">&#39;sub&#39;</span><span class="p">,</span>
             <span class="s1">&#39;mul&#39;</span><span class="p">,</span>
             <span class="s1">&#39;div&#39;</span><span class="p">,</span>
             <span class="s1">&#39;truediv&#39;</span><span class="p">,</span>
             <span class="s1">&#39;floordiv&#39;</span><span class="p">,</span>
             <span class="s1">&#39;mod&#39;</span><span class="p">,</span>
             <span class="s1">&#39;divmod&#39;</span><span class="p">,</span>
             <span class="s1">&#39;pow&#39;</span><span class="p">,</span>
             <span class="s1">&#39;and&#39;</span><span class="p">,</span>
             <span class="s1">&#39;or&#39;</span><span class="p">]:</span>
  <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;r</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;__</span><span class="si">%s</span><span class="s1">__&#39;</span><span class="p">,</span> <span class="s1">&#39;__r</span><span class="si">%s</span><span class="s1">__&#39;</span><span class="p">]:</span>
    <span class="c1"># TODO: non-trivial level?</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">p</span> <span class="o">%</span> <span class="n">base</span>
    <span class="nb">setattr</span><span class="p">(</span>
        <span class="n">DeferredSeries</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">restrictions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}))</span>
    <span class="nb">setattr</span><span class="p">(</span>
        <span class="n">DeferredDataFrame</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">restrictions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}))</span>
  <span class="nb">setattr</span><span class="p">(</span>
      <span class="n">DeferredSeries</span><span class="p">,</span>
      <span class="s1">&#39;__i</span><span class="si">%s</span><span class="s1">__&#39;</span> <span class="o">%</span> <span class="n">base</span><span class="p">,</span>
      <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;__i</span><span class="si">%s</span><span class="s1">__&#39;</span> <span class="o">%</span> <span class="n">base</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
  <span class="nb">setattr</span><span class="p">(</span>
      <span class="n">DeferredDataFrame</span><span class="p">,</span>
      <span class="s1">&#39;__i</span><span class="si">%s</span><span class="s1">__&#39;</span> <span class="o">%</span> <span class="n">base</span><span class="p">,</span>
      <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="s1">&#39;__i</span><span class="si">%s</span><span class="s1">__&#39;</span> <span class="o">%</span> <span class="n">base</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lt&#39;</span><span class="p">,</span> <span class="s1">&#39;le&#39;</span><span class="p">,</span> <span class="s1">&#39;gt&#39;</span><span class="p">,</span> <span class="s1">&#39;ge&#39;</span><span class="p">,</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;ne&#39;</span><span class="p">]:</span>
  <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;__</span><span class="si">%s</span><span class="s1">__&#39;</span><span class="p">:</span>
    <span class="c1"># Note that non-underscore name is used for both as the __xxx__ methods are</span>
    <span class="c1"># order-sensitive.</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredSeries</span><span class="p">,</span> <span class="n">p</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredDataFrame</span><span class="p">,</span> <span class="n">p</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;__neg__&#39;</span><span class="p">,</span> <span class="s1">&#39;__pos__&#39;</span><span class="p">,</span> <span class="s1">&#39;__invert__&#39;</span><span class="p">]:</span>
  <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredSeries</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
  <span class="nb">setattr</span><span class="p">(</span><span class="n">DeferredDataFrame</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">frame_base</span><span class="o">.</span><span class="n">_elementwise_method</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

<span class="n">DeferredSeries</span><span class="o">.</span><span class="n">multiply</span> <span class="o">=</span> <span class="n">DeferredSeries</span><span class="o">.</span><span class="n">mul</span>  <span class="c1"># type: ignore</span>
<span class="n">DeferredDataFrame</span><span class="o">.</span><span class="n">multiply</span> <span class="o">=</span> <span class="n">DeferredDataFrame</span><span class="o">.</span><span class="n">mul</span>  <span class="c1"># type: ignore</span>


<span class="k">def</span> <span class="nf">_slice_parts</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="k">yield</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span>
  <span class="k">yield</span> <span class="n">s</span><span class="o">.</span><span class="n">stop</span>
  <span class="k">yield</span> <span class="n">s</span><span class="o">.</span><span class="n">step</span>

<span class="k">def</span> <span class="nf">_is_null_slice</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_slice_parts</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_is_integer_slice</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
      <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_slice_parts</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_null_slice</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>